openapi: 3.0.3
info:
  title: Person & Person Contact API
  version: 1.0.0
  description: API for creating, updating, and retrieving prisoner personal contact details.

servers:
  # Added by API Auto Mocking Plugin
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/ftl/person/1.0.0
  - url: https://api.yourdomain.tld

tags:
  - name: Person
    description: Endpoints for prisoner personal contact information

paths:
  /person/prison/{prisonNumber}/person-contact:
    post:
      summary: Create person contacts for a prisoner
      tags: [Person Contact]
      parameters:
        - name: prisonNumber
          in: path
          required: true
          schema:
            type: string
            example: A6443EG
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PersonContactRequest"
            examples:
              sample:
                value:
                  contact:
                    nomisContactId: "1234"
                    contactType: "MOBILE"
                    contactValue: "+44 7700 900123"
                    extension: null

      responses:
        '200':
          description: Person contacts processed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PersonContactResponse"
              examples:
                sample:
                  value:
                    prisonerNumber: "A6443EG"
                    personContactMappings:
                      nomisContactId: "1234"
                      cprContactId: "e34a39e9-c22a-44c3-87ae-ab5017f465c3"
        '400':
          description: Invalid request
        '404':
          description: Prisoner not found

  /person/prison/{prisonNumber}/person-contact/{cprPersonContactId}:
    put:
      summary: Update an existing CPR person contact record for a prisoner
      tags: [Person Contact]
      parameters:
        - name: prisonNumber
          in: path
          required: true
          schema:
            type: string
        - name: cprPersonContactId
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: e34a39e9-c22a-44c3-87ae-ab5017f465c3
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PersonContactRequest"
            examples:
              sample:
                value:
                  contact:
                    nomisContactId: "1234"
                    contactType: "MOBILE"
                    contactValue: "+44 7700 900123"
                    extension: null
      responses:
        '200':
          description: Person contacts updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PersonContactPutResponse"
        '400':
          description: Invalid request
        '404':
          description: Person contact not found

    get:
      summary: Retrieve CPR personal contact information
      tags: [Person Contact]
      parameters:
        - name: prisonNumber
          in: path
          required: true
          schema:
            type: string
            example: A6443EG
        - name: cprPersonContactId
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: b7bb703f-d55e-419d-9126-b37ceb6e1b9d
      responses:
        '200':
          description: Contact details for the CPR contact
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PersonContactGetResponse"
              examples:
                sample:
                  value:
                    prisonNumber: "A6443EG"
                    contact:
                      contactType: "MOBILE"
                      contactValue: "+44 7700 900123"
                      extension: null

        '404':
          description: CPR person contact not found

  /person/{prisonNumber}:
    put:
      summary: Update core person details
      description: >
        Updates demographic attributes for the specified prisoner.
        Returns HTTP 200 with an empty response body on success.
      tags:
        - Person
      parameters:
        - name: prisonNumber
          in: path
          required: true
          description: Prisoner number (e.g., NOMIS prisoner number)
          schema:
            type: string
            example: "A6443EG"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PersonUpdateRequest"
            examples:
              sample:
                value:
                  birthPlace: "Bristol"
                  birthCountryCode: "GB"
                  ethnicityCode: "W1"
                  sexualOrientation: "HET"
                  interestToImmigration: false
                  disability: false
                  nationalityCode: "GB"
                  nationalityNote: "Possibly Finnish"
      responses:
        '200':
          description: Successful update (empty body)
        '400':
          description: Invalid data supplied
        '404':
          description: Prisoner not found
        '409':
          description: Conflicting state (e.g., immutable prisoner)

components:
  schemas:
    # ----- POST/PUT REQUEST -----
    PersonContactRequest:
      type: object
      required: [contact]
      properties:
        contact:
          $ref: "#/components/schemas/PersonContactItem"

    PersonContactItem:
      type: object
      properties:
        nomisContactId:
          type: string
          example: "1234"
        contactType:
          type: string
          example: "MOBILE"
        contactValue:
          type: string
          example: "+44 7700 900123"
        extension:
          type: string
          nullable: true
          example: null

    # ----- POST RESPONSE -----
    PersonContactResponse:
      type: object
      properties:
        prisonerNumber:
          type: string
          example: "A6443EG"
        personContactMappings:
          $ref: "#/components/schemas/PersonContactMapping"

    PersonContactMapping:
      type: object
      properties:
        nomisContactId:
          type: string
        cprContactId:
          type: string
          format: uuid

    # ----- PUT RESPONSE -----
    PersonContactPutResponse:
      type: object
      properties:
        prisonerNumber:
          type: string
          example: "A6443EG"
        personContactMappings:
          $ref: "#/components/schemas/PersonContactPutMapping"

    PersonContactPutMapping:
      type: object
      properties:
        nomisContactId:
          type: string
        cprContactId:
          type: string
          format: uuid

    # ----- GET RESPONSE (NOMIS ID REMOVED) -----
    PersonContactGetResponse:
      type: object
      description: Contact info returned
      properties:
        contact:
          type: array
          items:
            $ref: "#/components/schemas/PersonContactWithoutNomisId"

    PersonContactWithoutNomisId:
      type: object
      description: Contact info for person
      properties:
        contactType:
          type: string
          example: "MOBILE"
        contactValue:
          type: string
          example: "+44 7700 900123"
        extension:
          type: string
          nullable: true

    # ----- PERSON UPDATE ------
    PersonUpdateRequest:
      type: object
      properties:
        birthPlace:
          type: string
          example: "Bristol"
        birthCountryCode:
          type: string
          example: "GB"
        ethnicityCode:
          type: string
          example: "W1"
        sexualOrientation:
          type: string
          example: "HET"
        interestToImmigration:
          type: boolean
          example: false
        disability:
          type: boolean
          example: false
        nationalityCode:
          type: string
          example: "GB"
        nationalityNote:
          type: string
          example: "Possibly Finnish"

    # ----- COMMON ERROR -----
    ErrorResponse:
      type: object
      properties:
        status:
          type: integer
        error:
          type: string
        message:
          type: string